"use strict";const searchInput=document.querySelector(".js-input"),searchBtn=document.querySelector(".js-btn"),cardsList=document.querySelector(".js-list"),favCardsList=document.querySelector(".js-fav-list"),resetButton=document.querySelector(".js-reset-btn"),favsSection=document.querySelector(".js-fav-cards");let countriesList=[],favouriteCountries=[];function getData(){fetch("https://restcountries.com/v3.1/all/").then(e=>e.json()).then(e=>{const t=e.map(e=>({name:e.name.common,id:Math.floor(500*Math.random()),img:e.flags.png,alt:e.flags.alt,continent:e.continents[0],capital:e.capital,currencies:e.currencies})).sort((e,t)=>e.name.toLowerCase().localeCompare(t.name.toLowerCase()));console.log(t),countriesList=t,renderCountriesList()})}function getLocalFav(){const e=JSON.parse(localStorage.getItem("favourites"));null!==e&&(favouriteCountries=e,renderFavCountries())}function renderCards(e){const t=document.createElement("li");t.classList.add("cards-list-item");const n=document.createElement("article");-1!==favouriteCountries.findIndex(t=>t.id===e.id)?n.classList.add("card","js-fav-card","selected"):n.classList.add("card","js-card"),n.setAttribute("id",e.id);const a=document.createElement("img");a.setAttribute("src",e.img),a.setAttribute("alt",e.alt),a.setAttribute("title",e.name),a.classList.add("card-img");const s=document.createElement("h3");s.classList.add("card-name");const r=document.createTextNode(e.name),i=document.createElement("p");i.classList.add("card-continent");const c=document.createTextNode(e.continent);s.appendChild(r),i.appendChild(c),n.appendChild(a),n.appendChild(s),n.appendChild(i),t.appendChild(n);return t}function renderCountriesList(){cardsList.innerHTML="";for(const e of countriesList)cardsList.appendChild(renderCards(e));cardListeners()}function handleClickCard(e){e.currentTarget.classList.add("selected");const t=parseInt(e.currentTarget.id),n=countriesList.find(e=>e.id===t),a=favouriteCountries.findIndex(e=>e.id===t);-1===a?favouriteCountries.push(n):(favouriteCountries.splice(a,1),e.currentTarget.classList.remove("selected")),localStorage.setItem("favourites",JSON.stringify(favouriteCountries)),renderFavCountries()}function cardListeners(){const e=document.querySelectorAll(".js-card");for(const t of e)t.addEventListener("click",handleClickCard)}function renderFavCard(e){const t=document.createElement("li");t.classList.add("cards-list-item");const n=document.createElement("article");n.classList.add("favcard","js-fav-card","selected"),n.setAttribute("id",e.id);const a=document.createElement("i");a.classList.add("fa-solid","fa-square-xmark");const s=document.createElement("img");s.setAttribute("src",e.img),s.setAttribute("alt",e.alt),s.setAttribute("title",e.name),s.classList.add("card-img");const r=document.createElement("h3");r.classList.add("card-name");const i=document.createTextNode(e.name),c=document.createElement("p");c.classList.add("card-continent","favcard-text");const d=document.createTextNode("Continent: "+e.continent),o=document.createElement("p");o.classList.add("card-capital","favcard-text");const l=document.createTextNode("Capital: "+e.capital[0]);r.appendChild(i),c.appendChild(d),o.appendChild(l),n.appendChild(a),n.appendChild(s),n.appendChild(r),n.appendChild(c),n.appendChild(o),t.appendChild(n);return t}function paintFavSection(){0!==favouriteCountries.length?favsSection.classList.remove("hidden"):favsSection.classList.add("hidden"),paintReset()}function renderFavCountries(){favCardsList.innerHTML="";for(const e of favouriteCountries)favCardsList.appendChild(renderFavCard(e));paintFavSection(),favCardListeners()}function filterCards(){let e=searchInput.value.toLowerCase();cardsList.innerHTML="";const t=countriesList.filter(t=>t.name.toLowerCase().includes(e));for(const e of t)cardsList.appendChild(renderCards(e));""===e&&renderCountriesList()}function handleSearch(e){e.preventDefault(),filterCards(),cardListeners()}function handleResetInput(e){e.preventDefault(),""===searchInput.value.toLowerCase()&&renderCountriesList()}function handleClickFavCard(e){const t=parseInt(e.currentTarget.id);let n="";const a=favouriteCountries.findIndex(e=>e.id===t);favouriteCountries.splice(a,1);n=renderCards(countriesList.find(e=>e.id===t)),n.classList.remove("selected"),renderFavCountries(),renderCountriesList(),localStorage.setItem("favourites",JSON.stringify(favouriteCountries))}function favCardListeners(){const e=document.querySelectorAll(".js-fav-card");for(const t of e)t.addEventListener("click",handleClickFavCard)}function paintReset(){0!==favouriteCountries.length?resetButton.classList.remove("hidden"):resetButton.classList.add("hidden"),resetButton.addEventListener("click",(function(){favCardsList.innerHTML="",favouriteCountries=[],localStorage.removeItem("favourites"),resetButton.classList.add("hidden"),favsSection.classList.add("hidden");const e=document.querySelectorAll(".js-card");for(const t of e)t.classList.remove("selected")}))}getData(),getLocalFav(),searchBtn.addEventListener("click",handleSearch),searchInput.addEventListener("input",handleResetInput);